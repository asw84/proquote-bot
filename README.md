# Telegram-бот для котировки золота: @ProQuote_Bot

## 1. Обзор проекта

**@ProQuote_Bot** — это внутренний корпоративный Telegram-бот, разработанный для автоматизации процесса расчета котировок на золото. Основная задача — заменить ручные вычисления в Excel, снизить риск человеческой ошибки и ускорить предоставление цены клиенту в ключевые торговые часы.

Бот в реальном времени получает финансовые данные из внешних источников (API Московской Биржи и парсинг ProFinance), применяет к ним заданные пользователем дисконты и комиссии, и мгновенно предоставляет итоговый расчет.

### Ключевые функции:
- **Мульти-источники:** Возможность выбора между котировками с **MOEX** и **ProFinance**.
- **Два режима работы:** "Под сделку" и "Перепродажа" с разной логикой ввода данных.
- **Точное воспроизведение бизнес-логики:** Калькулятор бота реализует сложные, нелинейные формулы из эталонного Excel-файла.
- **Интерактивный сбор данных:** Бот последовательно запрашивает все необходимые параметры: вес партии, дисконт к биржевой цене и 5 видов комиссий.
- **Персистентность и логирование:** Полная интеграция с **MongoDB Atlas**. Все расчеты сохраняются в коллекции `logs`, доступ пользователей управляется через коллекцию `users`.
- **Система отчетности:** После каждого расчета генерируется подробный отчет, который по нажатию кнопки "Зафиксировать" отправляется в специальный закрытый Telegram-чат.

## 2. Технологический стек

- **Язык программирования:** Python 3.11
- **Основной фреймворк:** Aiogram 3.x
- **База данных:** MongoDB (облачная версия Atlas)
- **Драйвер БД:** `motor` + `pymongo`
- **Веб-скрейпинг:** `Firecrawl API` для получения HTML-кода защищенных страниц.
- **Парсинг HTML:** `BeautifulSoup4`
- **Развертывание:** Docker + Docker Compose

## 3. Инструкция по развертыванию

### Шаг 1: Подготовка `.env` файла

Создайте в корне проекта файл `.env` и заполните его по следующему шаблону:

```env
# Telegram Bot
BOT_TOKEN=ВАШ_ТЕЛЕГРАМ_ТОКЕН
REPORT_CHAT_ID=ID_ВАШЕГО_ЧАТА_ДЛЯ_ОТЧЕТОВ # (число, для групп начинается с -100)

# MongoDB
MONGO_USER="ВАШ_ПОЛЬЗОВАТЕЛЬ_БД"
MONGO_PASS="ВАШ_ПАРОЛЬ_ОТ_БД"
MONGO_HOST="АДРЕС_ВАШЕГО_КЛАСТЕРА" # например, cluster0.kymsraj.mongodb.net
MONGO_DB_NAME="ИМЯ_ВАШЕЙ_БАЗЫ_ДАННЫХ" # например, proquote_db

# Firecrawl & ProFinance
FIRECRAWL_API_KEY="ВАШ_КЛЮЧ_ОТ_FIRECRAWL"
PROFINANCE_RUB_URL="https://www.profinance.ru/usdrub/"
PROFINANCE_GOLD_URL="https://www.profinance.ru/chart/gold/"